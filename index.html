<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escáner DNI Argentina</title>
</head>
<body>
    <h2>Escanea el código de barras del DNI</h2>
    <button id="btnEscanear">Escanear DNI</button>
    <video id="video" style="width: 100%; max-width: 400px; display: none;" autoplay></video>
    <p><strong>Resultado:</strong> <span id="resultado"></span></p>
    <p><strong>Apellido:</strong> <span id="apellido"></span></p>
    <p><strong>Nombre:</strong> <span id="nombre"></span></p>
    <p><strong>DNI:</strong> <span id="dni"></span></p>
    <p><strong>Fecha Emisión:</strong> <span id="fechaEmision"></span></p>

    <script type="module">
        import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/library@latest/+esm';

        const codeReader = new BrowserMultiFormatReader();
        const videoElement = document.getElementById("video");
        const resultadoElement = document.getElementById("resultado");
        const btnEscanear = document.getElementById("btnEscanear");

        // Elementos donde se mostrarán los valores extraídos
        const apellidoElement = document.getElementById("apellido");
        const nombreElement = document.getElementById("nombre");
        const dniElement = document.getElementById("dni");
        const fechaEmisionElement = document.getElementById("fechaEmision");

        btnEscanear.addEventListener("click", () => {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
                .then(stream => {
                    videoElement.srcObject = stream;
                    videoElement.style.display = "block"; // Muestra el video
                    videoElement.play();

                    codeReader.decodeFromVideoDevice(undefined, videoElement, (result, err) => {
                        if (result) {
                            const datos = result.text;
                            resultadoElement.textContent = datos;

                            // Separar los datos por "@"
                            const partes = datos.split("@");

                            if (partes.length >= 9) {
                                const nroTramite = partes[0];
                                const apellido = partes[1];
                                const nombre = partes[2];
                                const sexo = partes[3];
                                const dni = partes[4];
                                const ejemplar = partes[5];
                                const fechaNacimiento = partes[6];
                                const fechaEmision = partes[7];
                                const dniUltimoDato = partes[8];

                                // Asignar valores a las variables
                                apellidoElement.textContent = apellido;
                                nombreElement.textContent = nombre;
                                dniElement.textContent = dni;
                                fechaEmisionElement.textContent = fechaEmision;
   
                                console.log("Número de Trámite:", nroTramite);
                                console.log("Apellido:", apellido);
                                console.log("Nombre:", nombre);
                                console.log("Sexo:", sexo);
                                console.log("DNI:", dni);
                                console.log("Ejemplar:", ejemplar);
                                console.log("Fecha de Nacimiento:", fechaNacimiento);
                                console.log("Fecha de Emisión:", fechaEmision);
                                console.log("Último Dato:", dniUltimoDato);
                            } else {
                                console.error("Formato de datos incorrecto.");
                            }

                            // Detener la cámara después de escanear
                            stream.getTracks().forEach(track => track.stop());
                            videoElement.style.display = "none"; // Oculta el video
                        }
                    });
                })
                .catch(err => console.error("Error accediendo a la cámara:", err));
        });
    </script>
</body>
</html>
